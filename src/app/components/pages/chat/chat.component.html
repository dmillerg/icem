<div class="contenedor">
  <form
    style="
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding-block: 10px;
    "
    *ngIf="disable"
  >
    <p class="text-danger">Antes de empezar por favor escriba su nombre</p>
    <input
      class="form-control"
      name="nombre"
      [(ngModel)]="nombre"
      type="text"
      placeholder="Nombre"
      aria-label="default input example"
      style="margin-block: 10px"
    />
    <button class="btn btn-primary" (click)="comenzar()">Aceptar</button>
  </form>

  <div class="box-sms" id="box-sms">
    <div class="box-screen" [hidden]="!borrando">
      <div class="box-delete">
        <div style="width: 40%; padding-left: 5%">
          <div class="loading loading-rotate"></div>
        </div>
        <div style="width: 60%" class="text-stat">
          <p>Borrando historial por favor espere...</p>
          <p>{{ cantBorradas }}/{{ cantMax }}</p>
        </div>
      </div>
    </div>
    <p class="text-center text-danger" style="width: 100%;" [hidden]="mensajes.length > 0 || nombre.length == 0">{{messageChat}}</p>
    <div
      *ngFor="let item of mensajes"
      style="width: 100%; display: flex; flex-direction: row"
    >
      <div
        class="item-sms text-start"
        style="width: 50%"
        [ngClass]="{
          'visibility-on': item.nombre != nombre,
          'visibility-off': item.nombre == nombre
        }"
        (click)=" downloadFile(item.archivo)"
      >
        <img [src]="item.imagen" [hidden]="item.archivo == ''" />
        <p>{{ item.sms }}</p>
        <p class="font-small">
          {{ item.nombre }} {{ item.fecha | date: "hh:mm:ss" }}
        </p>
      </div>
      <div
        class="item-sms text-end"
        style="width: 50%"
        [ngClass]="{
          'visibility-off': item.nombre != nombre,
          'visibility-on': item.nombre == nombre
        }"
        (click)=" downloadFile(item.archivo)"
      >
        <img [src]="item.imagen" [hidden]="item.archivo == ''" />
        <p>{{ item.sms }}</p>
        <p class="font-small">
          {{ item.nombre }} {{ item.fecha | date: "hh:mm:ss" }}
        </p>
      </div>
    </div>
  </div>
  <div class="chat-form bg-outline-primary">
    <button
      (click)="borrarTodo()"
      [title]="'borrar el historial de mensajes'"
      [disabled]="disable"
      class="btn btn-outline-danger mb-3"
      style="width: 10%; font-size: large; margin-inline: 15px"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        fill="currentColor"
        class="bi bi-eraser"
        viewBox="0 0 16 16"
      >
        <path
          d="M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828l6.879-6.879zm2.121.707a1 1 0 0 0-1.414 0L4.16 7.547l5.293 5.293 4.633-4.633a1 1 0 0 0 0-1.414l-3.879-3.879zM8.746 13.547 3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293l.16-.16z"
        />
      </svg>
    </button>
    <button
      (click)="upload()"
      [title]="message"
      [disabled]="disable"
      class="btn btn-upload mb-3"
      [ngClass]="{'btn-upload': message.length == 0, 'btn-outline-success': message.length > 0}"
      style="width: 10%; font-size: large; margin-inline: 15px"
    >
      <svg
        *ngIf="message.length > 0"
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        fill="currentColor"
        class="bi bi-cloud-check"
        viewBox="0 0 16 16"
      >
        <path
          fill-rule="evenodd"
          d="M10.354 6.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708 0z"
        />
        <path
          d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"
        />
      </svg>
      <svg
        *ngIf="message.length == 0"
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        fill="currentColor"
        class="bi bi-cloud-arrow-up"
        viewBox="0 0 16 16"
      >
        <path
          fill-rule="evenodd"
          d="M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"
        />
        <path
          d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"
        />
      </svg>
    </button>
    <form class="row g-3" style="width: 80%">
      <div class="col-auto" style="width: 70%">
        <input
          type="text"
          name="sms"
          [(ngModel)]="sms"
          class="form-control"
          id="sms"
          placeholder="texto..."
          [disabled]="disable"
        />
      </div>
      <input
        hidden
        name="imagen"
        type="file"
        id="formFile"
        accept="image/*"
        (change)="fileEvent($event)"
        [disabled]="disable"
      />

      <div class="col-auto" style="width: 20%">
        <button
          type="submit"
          (click)="enviar()"
          class="btn btn-primary mb-3"
          [disabled]="disable || (sms == '' && uploadFiles == undefined)"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            class="bi bi-send"
            viewBox="0 0 16 16"
          >
            <path
              d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"
            />
          </svg>
        </button>
      </div>
    </form>
  </div>
</div>
